/* ---------------------------------------------------- */
/*  Generated by Enterprise Architect Version 14.0 		*/
/*  Created On : 07-øíj-2019 14:00:56 				    */
/*  DBMS       : SQL Server 2012 						*/
/* ---------------------------------------------------- */

/* Drop Foreign Key Constraints */

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Garantuje_Ucitel]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Predmet] DROP CONSTRAINT [FK_Garantuje_Ucitel]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Studuje_Obor]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Student] DROP CONSTRAINT [FK_Studuje_Obor]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Student_Zapis]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Zapis] DROP CONSTRAINT [FK_Student_Zapis]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[FK_Predmet_Zapis]') AND OBJECTPROPERTY(id, N'IsForeignKey') = 1) 
ALTER TABLE [Zapis] DROP CONSTRAINT [FK_Predmet_Zapis]
GO

/* Drop Tables */

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Obor]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Obor]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Predmet]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Predmet]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Student]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Student]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Ucitel]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Ucitel]
GO

IF EXISTS (SELECT 1 FROM dbo.sysobjects WHERE id = object_id(N'[Zapis]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [Zapis]
GO

/* Create Tables */

CREATE TABLE [Obor]
(
	[OborID] int NOT NULL,
	[Nazev] varchar(50) NULL
)
GO

CREATE TABLE [Predmet]
(
	[PredmetID] int NOT NULL,
	[Nazev] varchar(50) NULL,
	[Mistnost] varchar(6) NULL,
	[UcitelID] int NULL
)
GO

CREATE TABLE [Student]
(
	[StudentID] int NOT NULL,
	[Jmeno] varchar(50) NULL,
	[Prijmeni] varchar(50) NULL,
	[Vek] int NULL,
	[Rocnik] int NULL,
	[OborID] int NULL
)
GO

CREATE TABLE [Ucitel]
(
	[UcitelID] int NOT NULL,
	[Jmeno] varchar(50) NULL,
	[Prijmeni] varchar(50) NULL,
	[Titul] varchar(20) NULL
)
GO

CREATE TABLE [Zapis]
(
	[Hodnoceni] int NULL,
	[StudentID] int NOT NULL,
	[PredmetID] int NOT NULL
)
GO

/* Create Primary Keys, Indexes, Uniques, Checks */

ALTER TABLE [Obor] 
 ADD CONSTRAINT [PK_Obor]
	PRIMARY KEY CLUSTERED ([OborID] ASC)
GO

ALTER TABLE [Predmet] 
 ADD CONSTRAINT [PK_Predmet]
	PRIMARY KEY CLUSTERED ([PredmetID] ASC)
GO

ALTER TABLE [Student] 
 ADD CONSTRAINT [PK_Student]
	PRIMARY KEY CLUSTERED ([StudentID] ASC)
GO

ALTER TABLE [Ucitel] 
 ADD CONSTRAINT [PK_Ucitel]
	PRIMARY KEY CLUSTERED ([UcitelID] ASC)
GO

ALTER TABLE [Zapis] 
 ADD CONSTRAINT [PK_Zapis]
	PRIMARY KEY CLUSTERED ([StudentID] ASC,[PredmetID] ASC)
GO

/* Create Foreign Key Constraints */

ALTER TABLE [Predmet] ADD CONSTRAINT [FK_Garantuje_Ucitel]
	FOREIGN KEY ([UcitelID]) REFERENCES [Ucitel] ([UcitelID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Student] ADD CONSTRAINT [FK_Studuje_Obor]
	FOREIGN KEY ([OborID]) REFERENCES [Obor] ([OborID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Zapis] ADD CONSTRAINT [FK_Student_Zapis]
	FOREIGN KEY ([StudentID]) REFERENCES [Student] ([StudentID]) ON DELETE No Action ON UPDATE No Action
GO

ALTER TABLE [Zapis] ADD CONSTRAINT [FK_Predmet_Zapis]
	FOREIGN KEY ([PredmetID]) REFERENCES [Predmet] ([PredmetID]) ON DELETE No Action ON UPDATE No Action
GO


INSERT INTO Obor (OborID, Nazev)
VALUES (1, 'SWI'), (2, 'BTSM'), (3, 'IØT'), (4, 'IA')

SELECT OborID, Nazev FROM Obor

INSERT INTO Student (StudentID, Jmeno, Prijmeni, Vek, Rocnik, OborID)
VALUES (1,  'Jan', 'Novák', 20, 1, 1), (2, 'Oto', 'Pavel', 22, 3, 3), (3, 'Karel', 'Novotný', 21, 2, 1), (4, 'Daniel', 'Petr', 21, 2, 4), (5, 'Jiøí', 'Bota', 20, 1, 1)

INSERT INTO Ucitel (UcitelID, Jmeno, Prijmeni, Titul)
VALUES (1, 'Karel', 'Kantor', 'PhD.'), (2, 'Jan', 'Chytrý', 'Doc.'), (3, 'Dominik', 'Krátký', 'RNDr.'), (4, 'Igor', 'Chvátal', 'PhD.'), (5, 'Jaromír', 'Koneèný', 'CSc.')

INSERT INTO Predmet (PredmetID, Nazev, Mistnost, UcitelID)
VALUES (1, 'A1ZAP', 'A101', 2), (2, 'A1DBS', 'A102', 3), (3, 'A1NVS', 'A103', 1), (4, 'A1AMS', 'B125', 5), (5, 'A1FYS', 'C103', 4)

INSERT INTO Zapis 
VALUES (1, 2, 3), (3, 1, 5), (2, 2, 1), (4, 4, 3), (2, 3, 4), (1, 5, 1)

SELECT Hodnoceni, StudentID, PredmetID FROM Zapis

ALTER TABLE Predmet ADD
DocasnySloupec varchar(5) NULL